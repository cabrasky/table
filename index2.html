<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <meta name="author" content="Cabrasky">
</head>
<body>
    <div id="table_frame">

    </div>
    <style>

        *{
            padding: 0;
            margin: 0;
        }
        .table {
            display: block;
            max-width: -moz-fit-content;
            max-width: fit-content;
            overflow: hidden;
            white-space: nowrap;
            font-size: 0;
        }
        .dCell, .hCell{
            position: relative;
            display: block;
            font-size: 20px;
            overflow-x: hidden;
            top: 0px;
            border: 1px solid black;
        }
        .col{
            display: inline-block;
            background-color: gray;
        }.col:first-child{
            margin-left: 0px;
        }
        .innerCol{
            display: inline-block;
            width: calc(100% - 5px)
        }
        .col:last-child .innerCol{
            width: calc(100% - 2.5px);
        }
        .hResize{
            width: 5px;
            position: relative;
            top: 0px;
            display: flex;
            float: right;
            cursor:col-resize;
            user-select: none;
            background: white;
            color: white;
        }
        .col:last-child .hResize{
            width: 2.5px;
            
        }
        #tableSlider{
            width: 100%;
            height: 10px;
            background-color: wheat;
        }
        .tableSliderBar{
            position: relative;
            height: 8px;
            margin-top: 1px;
            background-color: black;
        }
        .d_data {
            display: inline-block;
        }
    </style>
    
</body>
<script>
    var beenClicked = undefined
    var min_width = 30
    class table {
        constructor(){
            this.headers_data = []
            this.rows_data = []
            this.node = document.createElement('div')
            this.node.classList.add("table")
            this.resizers = []
        }

        addColumn = function(colInfo){
            this.addColumn_i(colInfo)
        }

        addColumn_i = function(header_data){
            
            this.headers_data.push(header_data)
            var col = document.createElement("div")
            col.classList.add("col")
            col["column_id"] = header_data["id"]
            var id = Math.random()
            col.id = id
            header_data["html_id"] = id
            var innerCol = document.createElement("div")
            innerCol.classList.add("innerCol")
            var act_header_info = header_data
            var act_header = document.createElement("div")
            var p_data = document.createElement("p")
            p_data.classList.add("d_data")
            p_data.innerHTML = act_header_info.innerHTML
            act_header.appendChild(p_data)
            act_header.classList.add("hCell")
            var hResize = document.createElement("div")
            hResize.classList.add("hResize")
            hResize.addEventListener("mousedown", function(e){resizeListener(e)}); 
            innerCol.appendChild(act_header)
            col.appendChild(innerCol)
            col.appendChild(hResize)
            this.resizers.push(hResize)
            this.node.appendChild(col)

            setTimeout(() => {
                this.hResizeHeight()
                resizeScrollBar(this.node)
            }, 10);
        }

        hResizeHeight = function(){
            var height = this.node.getBoundingClientRect().height
            for(var i = 0; i < this.resizers.length; i++){
                this.resizers[i].style.height = height + "px"
            }
        }

        addRow = function(rowInfo){
            this.rows_data.push(rowInfo)
            for(var i = 0; i < this.headers_data.length; i++){
                var actual_header = this.headers_data[i]
                var act_dataCell = document.createElement("div")
                act_dataCell.classList.add("hCell")
                var headerName = actual_header["id"]
                try {
                    var act_dataP = document.createElement("p")
                    act_dataP.classList.add("d_data")
                    act_dataP.innerHTML = rowInfo[headerName]
                    act_dataCell.append(act_dataP)
                } catch (error) {
                    
                }
                var col = document.getElementById(actual_header["html_id"])
                col.children[0].appendChild(act_dataCell)
            }
            this.hResizeHeight()
        }
    }


    var lastPosition = {
        x: 0.00,
        y: 0.00
    }

    var clickOffset = 0
    onmousemove = function(e){
        if(beenClicked){
            if(beenClicked.classList.contains("hResize")){
                var parent = beenClicked.parentElement
                parent["width"] += e.clientX - lastPosition.x
                if(parent["width"] < min_width){
                    parent.style.width = 30 + "px"
                } else {
                    parent.style.width = parent["width"] + "px"
                }
                
                resizeScrollBar(parent.parentElement)
            } else if (beenClicked.classList.contains("tableSliderBar")){
                beenClicked["left"] += (e.clientX - lastPosition.x)
                var scroll
                if(beenClicked["left"] < 0){
                    beenClicked.style.left = 0 + "px"
                    scroll = 0
                } else if(beenClicked["left"] / beenClicked["relation"] > beenClicked.parentElement.parentElement.getElementsByClassName("table")[0].scrollLeftMax){
                    beenClicked.style.left = beenClicked.parentElement.parentElement.getElementsByClassName("table")[0].scrollLeftMax * beenClicked["relation"] + "px"
                    scroll = beenClicked.parentElement.parentElement.getElementsByClassName("table")[0].scrollLeftMax
                } else {
                    beenClicked.style.left = beenClicked["left"] + "px"
                    scroll = beenClicked["left"] / beenClicked["relation"]
                }
                beenClicked.parentElement.parentElement.getElementsByClassName("table")[0].scrollTo(scroll, 0)
            }
            
            lastPosition.x = e.clientX
            lastPosition.y = e.clientY
            
        }
    }
    
    onmouseup = function(){
        beenClicked = undefined
    }

    function resizeListener(e){
        beenClicked = e.target
        lastPosition.x = e.clientX
        lastPosition.y = e.clientY        
        console.log(e.target)
        e.target.parentElement["width"] = e.target.parentElement.getBoundingClientRect().width
    }
    window.onresize = function(){
        var tables = document.getElementsByClassName("table")
        for(var i = 0; i < tables.length; i++){
            var act_table = tables[i]
            resizeScrollBar(act_table)
        }
    }
    function isOverflown(element) {
        return element.scrollWidth > element.parentElement.getBoundingClientRect().width;
    }
    function resizeScrollBar(act_table){

        function recalcScroll(tableSliderBar){
            tableSliderBar["relation"] = tableSliderBar.parentElement.getBoundingClientRect().width / act_table.scrollWidth
            tableSliderBar.style.width = tableSliderBar["relation"] * 100 + "%"
        }

        if(isOverflown(act_table) && act_table.parentElement.getElementsByClassName("tableSlider").length == 0){
            var scrollBar = document.createElement("div")
            scrollBar.classList.add("tableSlider")
            var tableSliderBar = document.createElement("div")
            tableSliderBar.classList.add("tableSliderBar")
            tableSliderBar["left"] = 0;
            tableSliderBar.addEventListener("mousedown", function(e){
                beenClicked = e.target
                lastPosition.x = e.clientX
                lastPosition.y = e.clientY
                clickOffset = (e.clientX - tableSliderBar.getBoundingClientRect().left)
            })
            scrollBar.appendChild(tableSliderBar)
            act_table.parentElement.appendChild(scrollBar)
            recalcScroll(tableSliderBar)
        } else if(isOverflown(act_table) && act_table.parentElement.getElementsByClassName("tableSlider").length == 1){
            var tableSliderBar = act_table.parentElement.getElementsByClassName("tableSliderBar")[0]
            recalcScroll(tableSliderBar)
        } else if(act_table.parentElement.getElementsByClassName("tableSlider").length == 1){
            act_table.parentElement.getElementsByClassName("tableSlider")[0].remove()
        }
    }
</script>
<script>

    var _table = new table()
    var table_frame = document.getElementById("table_frame")
    table_frame.appendChild(_table.node)

    
    _table.addColumn({"innerHTML": "hola", "id": "hola", "visible": true})
    _table.addColumn({"innerHTML": "adios", "id": "adios", "visible": true})
    _table.addColumn({"innerHTML": "test", "id": "test", "visible": true})

    for(var i = 0; i < 12; i++){
        _table.addRow({"hola": i, "adios": i + 1, "test": i + 2,})
    }


</script>
</html>
